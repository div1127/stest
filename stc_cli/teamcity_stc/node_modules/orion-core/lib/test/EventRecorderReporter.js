"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _stringify=require("babel-runtime/core-js/json/stringify"),_stringify2=_interopRequireDefault(_stringify),_typeof2=require("babel-runtime/helpers/typeof"),_typeof3=_interopRequireDefault(_typeof2),_assign=require("babel-runtime/core-js/object/assign"),_assign2=_interopRequireDefault(_assign),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),ReporterBase=require("../reporter/ReporterBase"),logger=require("../Logger").getInstance().forClass("test/EventRecorderReporter"),EventRecorderReporter=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"ctor",value:function(a){logger.trace(".ctor <=","cfg"),(0,_assign2["default"])(this,a),this.recordEnabledTests=[]}},{key:"testRunStarted",value:function(a){logger.trace(".testRunStarted <=",a.type);var b=a.agent;this.runner.fire({type:"testrunstarted",agent:b,message:a})}},{key:"testRunFinished",value:function(a){logger.trace(".testRunFinished <=",a.type);var b=a.agent;this.runner.fire({type:"testrunfinished",agent:b,message:a})}},{key:"recordingStarted",value:function(a){logger.trace(".recordingStarted <=",a.type),this.runner.fire("recordingstarted")}},{key:"recordingStopped",value:function(a){logger.trace(".recordingStopped <=",a.type),this.runner.agent&&this.runner.agent.terminate(),this.runner.fire("recordingstopped")}},{key:"recordedEvents",value:function(a){logger.trace(".recordedEvents <=",a.type),this.runner.fire({type:"recordedevents",events:a.events})}},{key:"testAdded",value:function(a){var b=a.testDef;logger.trace(".testAdded <=",b.name),b.recording&&this.recordEnabledTests.push(b)}},{key:"afterFiles",value:function(a){logger.trace(".afterFiles <=","message");var b=a.agent,c=this.recordEnabledTests.length,d="no recording enabled tests detected",e="multiple recording enabled tests detected";0===c?this.runner.fire({type:"recordingerror",message:d}):c>1?this.runner.fire({type:"recordingerror",message:e,tests:this.recordEnabledTests}):(this.runner.recordAgent=b,b.startTestRun(null,this.recordEnabledTests.map(function(a){return a.id})))}},{key:"systemError",value:function(a){logger.trace(".systemError <=","message");var b=this,c=a.agent,d=a.error||a.message;if("object"===("undefined"==typeof d?"undefined":(0,_typeof3["default"])(d)))d=(0,_stringify2["default"])(d,null,4);else if(d.match&&d.match(/SyntaxError: Illegal return statement/i))return;logger.error(d),Studio.alert(d),b.isRecording&&c.stopRecording(),Ext.fireEvent("systemerror",a)}}]),b}(ReporterBase);module.exports=EventRecorderReporter;