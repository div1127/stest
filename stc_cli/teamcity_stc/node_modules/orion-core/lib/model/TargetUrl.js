"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),Base=require("../Base"),Url=require("url"),startSlashRe=/^\//,protocolRe=/^(https?)?:?(?:\/{1,2})?([^#?]*)/i,logger=require("../Logger").getInstance().forClass("model/TargetUrl"),TargetUrl=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"getSubjectPath",value:function(){logger.trace(".getSubjectPath");var a,b=Url.parse(this.getFullTargetUrl()||"",!0);return a=Url.format({path:b.path.replace(startSlashRe,""),pathname:b.pathname.replace(startSlashRe,""),href:b.href,hash:b.hash,search:b.search}),logger.trace(".getSubjectPath =>",a),a}},{key:"getSubjectPage",value:function(){return logger.trace(".getSubjectPage"),Url.parse(this.getFullTargetUrl()||"",!0).pathname}},{key:"getProxyUrl",value:function(a,b){logger.trace(".getProxyUrl",a,b);var c=Url.parse(this.getFullTargetUrl()||"");return Url.format({protocol:c.protocol,hostname:c.hostname,port:c.port})}},{key:"getCalculatedTargetUrl",value:function(){logger.trace(".getCalculatedTargetUrl");var a=this.getTargetUrl(),b=Url.parse(a);return b.protocol&&"http:"!==b.protocol&&"https:"!==b.protocol&&(b.port=b.hostname,b.hostname=b.protocol,b.hostname.endsWith(":")&&(b.hostname=b.hostname.substring(0,b.hostname.length-1)),delete b.host,delete b.href,b.protocol="http"),Url.format(b)}},{key:"getFullTargetUrl",value:function(a,b){logger.trace(".getFullTargetUrl",a,b);var c=this.getCalculatedTargetUrl(),d=Url.parse(c);return d.protocol||(d.protocol="http",d.hostname?d.port=d.port||b:(d.hostname=a,d.port=d.port||b)),Url.format(d)}}],[{key:"meta",get:function(){return{mixinId:"targetUrl",prototype:{defaultProtocol:"http"}}}}]),b}(Base);module.exports=TargetUrl;