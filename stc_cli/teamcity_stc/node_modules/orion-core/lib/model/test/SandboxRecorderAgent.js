"use strict";function _interopRequireDefault(a){return a&&a.__esModule?a:{"default":a}}var _promise=require("babel-runtime/core-js/promise"),_promise2=_interopRequireDefault(_promise),_getPrototypeOf=require("babel-runtime/core-js/object/get-prototype-of"),_getPrototypeOf2=_interopRequireDefault(_getPrototypeOf),_classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn"),_possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2),_inherits2=require("babel-runtime/helpers/inherits"),_inherits3=_interopRequireDefault(_inherits2),util=require("util"),SandboxAgent=require("./SandboxAgent"),logger=require("../../Logger").getInstance().forClass("model/test/SandboxRecorderAgent"),SandboxRecorderAgent=function(a){function b(){return(0,_classCallCheck3["default"])(this,b),(0,_possibleConstructorReturn3["default"])(this,(b.__proto__||(0,_getPrototypeOf2["default"])(b)).apply(this,arguments))}return(0,_inherits3["default"])(b,a),(0,_createClass3["default"])(b,[{key:"terminate",value:function(){logger.trace(".terminate");var a,b=this;if(!b._terminated)return b._terminated=!0,b._agentTerminatePromise?logger.warn("agent.terminate() called multiple times."):(logger.debug("Waiting on agent to stop WebDriver."),b._agentTerminatePromise=new _promise2["default"](function(c,d){a?c():b.sendMessage({type:"stopRecording"},!0,function(){a=setInterval(function(){b.isRunning||(logger.debug("Sandbox terminated."),clearInterval(a),a=null,c())},500)})})),b._agentTerminatePromise}},{key:"recordingStopped",value:function(){logger.trace(".recordingStopped");var a=this;a.terminated()}},{key:"contextType",get:function(){return"webdriverrecorder"}}],[{key:"meta",get:function(){return{prototype:{isRecorder:!0}}}}]),b}(SandboxAgent);SandboxRecorderAgent.prototype.supportedMessages={browserClosed:1,log:1,recordingStopped:1,response:1,screenshot:1,terminate:1,testFinished:1,testRunStarted:1,testRunFinished:1},module.exports=SandboxRecorderAgent;